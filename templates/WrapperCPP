// File generated by HaxeNXCompiler v[PROGRAM_VERSION]
// WrapperCPP version: 1.1.1

#include <switch.h>

#include <cstdio>

#include <stdio.h>
#include <stdlib.h>
#include <string>

#include <hxcpp.h>

extern "C" void __hxcpp_main();
extern "C" void __hxcpp_lib_main();

extern int _hxcpp_argc;
extern char **_hxcpp_argv;

int main(int argc,char **argv)
{
    _hxcpp_argc = argc;
    _hxcpp_argv = argv;

    HX_TOP_OF_STACK
    hx::Boot();

    try
    {
        __boot_all();
        __hxcpp_main();
    }
    catch (Dynamic e)
    {
        __hx_dump_stack();

        // Try to show a error message
        consoleInit(NULL);

        padConfigureInput(1, HidNpadStyleSet_NpadStandard);

        PadState pad;
        padInitializeDefault(&pad);

        std::string hxnxcDefinedVersion = HAXENXCOMPILER_VERSION;
        std::string hxnxcDefinedProjectName = HAXENXCOMPILER_JSON_SWITCH_PROJECTNAME;

        printf("HxNXCompiler v%s -- Project: %s\nHAXE HXCPP CRASH!\n\nError: %s\n\n================\nPress + to return to hbmenu\n",
            hxnxcDefinedVersion.c_str(),
            hxnxcDefinedProjectName.c_str(),
            e==null() ? "null" : e->toString().__CStr());

        while (appletMainLoop())
        {
            padUpdate(&pad);
            u64 kDown = padGetButtonsDown(&pad);

            if (kDown & HidNpadButton_Plus)
                break; // break in order to return to hbmenu

            consoleUpdate(NULL);
        }
        consoleExit(NULL);
        return -1;
    }

    return 0;
}
