// File generated by HaxeNXCompiler v[PROGRAM_VERSION]
// WrapperCPP version: 1.2.0

#include <switch.h>

#include <cstdio>

#include <stdio.h>
#include <stdlib.h>
#include <string>

#include <hxcpp.h>

extern "C" void __hxcpp_main();
extern "C" void __hxcpp_lib_main();

extern int _hxcpp_argc;
extern char **_hxcpp_argv;

//////////////////////

int main(int argc, char **argv)
{
    _hxcpp_argc = argc;
    _hxcpp_argv = argv;

    try
    {
        // HX_TOP_OF_STACK
        // hx::Boot();
        // __boot_all();
        // __hxcpp_main();

        __hxcpp_lib_main();
    }
    catch (Dynamic e)
    {
        __hx_dump_stack();

        // Try to show a error message
        consoleInit(NULL);

        padConfigureInput(1, HidNpadStyleSet_NpadStandard);

        PadState pad;
        padInitializeDefault(&pad);

        consoleUpdate(NULL);

        std::string hxnxcDefinedVersion = HAXENXCOMPILER_VERSION;
        std::string hxnxcDefinedProjectName = HAXENXCOMPILER_JSON_SWITCH_PROJECTNAME;

        printf("HaxeNXCompiler v%s -- Project: %s\nHAXE HXCPP CRITICAL ERROR!\n\nError: %s\n\n================\nPress + to return to hbmenu\n",
                hxnxcDefinedVersion.c_str(),
                hxnxcDefinedProjectName.c_str(),
                e == null() ? "null" : e->toString().__CStr(), hxnxcDefinedProjectName.c_str());

        while (appletMainLoop())
        {
            padUpdate(&pad);
            u64 kDown = padGetButtonsDown(&pad);

            if (kDown & HidNpadButton_Plus)
                break; // break in order to return to hbmenu

            consoleUpdate(NULL);
        }
        consoleExit(NULL);
        return -1;
    }

    
    printf("HaxeNXCompiler v%s -- Project: %s\nProgram Finished!\n\n",
            HAXENXCOMPILER_VERSION,
            HAXENXCOMPILER_JSON_SWITCH_PROJECTNAME);
    return 0;
}